{
  "feature": "Split large action files into domain-specific modules",
  "description": "Three action files exceed recommended size limits: challenges.ts (588 lines), rewards.ts (533 lines), events.ts (411 lines). Each file contains both user-facing and admin actions mixed together, violating single responsibility.",
  "created_at": "2026-01-07T14:25:35.762Z",
  "updated_at": "2026-01-07T14:25:41.423Z",
  "status": "in_progress",
  "planStatus": "in_progress",
  "workflow_type": "development",
  "services_involved": [
    "src/actions"
  ],
  "spec_file": "spec.md",
  "phases": [
    {
      "id": "phase-1",
      "name": "Prepara\u00e7\u00e3o e Shared Types",
      "description": "Criar arquivo de tipos compartilhados para evitar duplica\u00e7\u00e3o e preparar estrutura",
      "subtasks": [
        {
          "id": "1.1",
          "title": "Criar arquivo de tipos compartilhados para actions",
          "description": "Criar src/actions/types.ts com ActionResponse e outras interfaces compartilhadas para evitar duplica\u00e7\u00e3o em cada arquivo",
          "status": "completed",
          "files": [
            "src/actions/types.ts"
          ],
          "notes": "Created src/actions/types.ts with ActionResponse<T> generic type and common status types for challenges, rewards, and events. The file includes comprehensive JSDoc comments and consolidates type definitions that were previously duplicated across multiple action files.",
          "updated_at": "2026-01-07T14:30:19.420504+00:00"
        },
        {
          "id": "1.2",
          "title": "Criar utilit\u00e1rio de verifica\u00e7\u00e3o de admin",
          "description": "Criar src/actions/utils.ts com fun\u00e7\u00e3o reutiliz\u00e1vel para verificar se usu\u00e1rio \u00e9 admin/creator, evitando duplica\u00e7\u00e3o de c\u00f3digo",
          "status": "completed",
          "files": [
            "src/actions/utils.ts"
          ],
          "notes": "Created src/actions/utils.ts with three reusable utility functions: verifyAdminOrCreator(), verifyAdmin(), and getAuthenticatedUser(). These functions follow the existing codebase patterns and use the shared ActionResponse type from types.ts. They will help eliminate code duplication when splitting the large action files into admin and user modules in subsequent phases.",
          "updated_at": "2026-01-07T14:32:17.529721+00:00"
        }
      ]
    },
    {
      "id": "phase-2",
      "name": "Split do m\u00f3dulo challenges",
      "description": "Separar challenges.ts em user e admin modules",
      "subtasks": [
        {
          "id": "2.1",
          "title": "Criar challenges-admin.ts com actions administrativas",
          "description": "Mover approveParticipation, rejectParticipation, toggleChallengeActive, markWinnerPaid, createChallenge, closeChallenge, registerWinner, markPrizeSent para novo arquivo",
          "status": "completed",
          "files": [
            "src/actions/challenges-admin.ts"
          ],
          "notes": "Criado arquivo src/actions/challenges-admin.ts com todas as 8 actions administrativas (approveParticipation, rejectParticipation, toggleChallengeActive, markWinnerPaid, createChallenge, closeChallenge, registerWinner, markPrizeSent). Refatorado para usar fun\u00e7\u00f5es utilit\u00e1rias compartilhadas (getAuthenticatedUser, verifyAdminOrCreator) e tipos do arquivo types.ts. Removidos console.error statements e mantida toda a l\u00f3gica de neg\u00f3cios original.",
          "updated_at": "2026-01-07T14:34:25.390049+00:00"
        },
        {
          "id": "2.2",
          "title": "Refatorar challenges.ts mantendo apenas user actions",
          "description": "Manter participateInChallenge e updateParticipation, importar tipos do arquivo compartilhado",
          "status": "completed",
          "files": [
            "src/actions/challenges.ts"
          ],
          "notes": "Refatorado src/actions/challenges.ts para manter apenas fun\u00e7\u00f5es de usu\u00e1rio (participateInChallenge e updateParticipation). Removidas todas as actions administrativas que foram movidas para challenges-admin.ts. Importado ActionResponse de './types' para usar tipo compartilhado. Removido console.error statement. Arquivo reduzido de 588 para 143 linhas (~75% de redu\u00e7\u00e3o).",
          "updated_at": "2026-01-07T14:36:17.447778+00:00"
        },
        {
          "id": "2.3",
          "title": "Atualizar imports de challenges-admin nos componentes",
          "description": "Atualizar admin/desafios/novo/page.tsx, admin/desafios/[id]/ParticipationActions.tsx, admin/desafios/[id]/WinnerActions.tsx, admin/desafios/[id]/ChallengeActions.tsx",
          "status": "pending",
          "files": [
            "src/app/(dashboard)/admin/desafios/novo/page.tsx",
            "src/app/(dashboard)/admin/desafios/[id]/ParticipationActions.tsx",
            "src/app/(dashboard)/admin/desafios/[id]/WinnerActions.tsx",
            "src/app/(dashboard)/admin/desafios/[id]/ChallengeActions.tsx"
          ]
        }
      ]
    },
    {
      "id": "phase-3",
      "name": "Split do m\u00f3dulo rewards",
      "description": "Separar rewards.ts em user e admin modules",
      "subtasks": [
        {
          "id": "3.1",
          "title": "Criar rewards-admin.ts com actions administrativas",
          "description": "Mover toggleRewardActive, approveClaim, markClaimShipped, markClaimDelivered, createReward, updateReward, addCoinsToUser para novo arquivo",
          "status": "pending",
          "files": [
            "src/actions/rewards-admin.ts"
          ]
        },
        {
          "id": "3.2",
          "title": "Refatorar rewards.ts mantendo apenas user actions",
          "description": "Manter claimReward e cancelClaim, importar tipos do arquivo compartilhado",
          "status": "pending",
          "files": [
            "src/actions/rewards.ts"
          ]
        },
        {
          "id": "3.3",
          "title": "Atualizar imports de rewards-admin nos componentes",
          "description": "Atualizar admin/usuarios/UserAdminComponents.tsx, admin/premios/RewardAdminComponents.tsx",
          "status": "pending",
          "files": [
            "src/app/(dashboard)/admin/usuarios/UserAdminComponents.tsx",
            "src/app/(dashboard)/admin/premios/RewardAdminComponents.tsx"
          ]
        }
      ]
    },
    {
      "id": "phase-4",
      "name": "Split do m\u00f3dulo events",
      "description": "Separar events.ts em user e admin modules",
      "subtasks": [
        {
          "id": "4.1",
          "title": "Criar events-admin.ts com actions administrativas",
          "description": "Mover createEvent, toggleEventActive, updateEvent, confirmEventRegistration para novo arquivo",
          "status": "pending",
          "files": [
            "src/actions/events-admin.ts"
          ]
        },
        {
          "id": "4.2",
          "title": "Refatorar events.ts mantendo apenas user actions",
          "description": "Manter registerForEvent, cancelEventRegistration, checkInEvent, submitEventFeedback, importar tipos do arquivo compartilhado",
          "status": "pending",
          "files": [
            "src/actions/events.ts"
          ]
        },
        {
          "id": "4.3",
          "title": "Atualizar imports de events-admin nos componentes",
          "description": "Atualizar admin/eventos/novo/page.tsx, admin/eventos/EventAdminActions.tsx",
          "status": "pending",
          "files": [
            "src/app/(dashboard)/admin/eventos/novo/page.tsx",
            "src/app/(dashboard)/admin/eventos/EventAdminActions.tsx"
          ]
        }
      ]
    },
    {
      "id": "phase-5",
      "name": "Atualiza\u00e7\u00e3o do index e valida\u00e7\u00e3o",
      "description": "Atualizar exports centralizados e validar funcionamento",
      "subtasks": [
        {
          "id": "5.1",
          "title": "Atualizar src/actions/index.ts com novos m\u00f3dulos",
          "description": "Adicionar exports para challenges-admin, rewards-admin, events-admin e manter compatibilidade com imports existentes",
          "status": "pending",
          "files": [
            "src/actions/index.ts"
          ]
        },
        {
          "id": "5.2",
          "title": "Verificar TypeScript compilation",
          "description": "Executar tsc --noEmit para garantir que n\u00e3o h\u00e1 erros de tipos",
          "status": "pending",
          "files": []
        },
        {
          "id": "5.3",
          "title": "Executar build de produ\u00e7\u00e3o",
          "description": "Executar npm run build para validar que a aplica\u00e7\u00e3o compila corretamente",
          "status": "pending",
          "files": []
        }
      ]
    }
  ],
  "analysis": {
    "challenges.ts": {
      "total_lines": 588,
      "user_actions": [
        "participateInChallenge",
        "updateParticipation"
      ],
      "admin_actions": [
        "approveParticipation",
        "rejectParticipation",
        "toggleChallengeActive",
        "markWinnerPaid",
        "createChallenge",
        "closeChallenge",
        "registerWinner",
        "markPrizeSent"
      ],
      "estimated_user_lines": 150,
      "estimated_admin_lines": 440
    },
    "rewards.ts": {
      "total_lines": 533,
      "user_actions": [
        "claimReward",
        "cancelClaim"
      ],
      "admin_actions": [
        "toggleRewardActive",
        "approveClaim",
        "markClaimShipped",
        "markClaimDelivered",
        "createReward",
        "updateReward",
        "addCoinsToUser"
      ],
      "estimated_user_lines": 185,
      "estimated_admin_lines": 350
    },
    "events.ts": {
      "total_lines": 411,
      "user_actions": [
        "registerForEvent",
        "cancelEventRegistration",
        "checkInEvent",
        "submitEventFeedback"
      ],
      "admin_actions": [
        "createEvent",
        "toggleEventActive",
        "updateEvent",
        "confirmEventRegistration"
      ],
      "estimated_user_lines": 205,
      "estimated_admin_lines": 205
    }
  },
  "file_summary": {
    "new_files": [
      "src/actions/types.ts",
      "src/actions/utils.ts",
      "src/actions/challenges-admin.ts",
      "src/actions/rewards-admin.ts",
      "src/actions/events-admin.ts"
    ],
    "modified_files": [
      "src/actions/challenges.ts",
      "src/actions/rewards.ts",
      "src/actions/events.ts",
      "src/actions/index.ts",
      "src/app/(dashboard)/admin/desafios/novo/page.tsx",
      "src/app/(dashboard)/admin/desafios/[id]/ParticipationActions.tsx",
      "src/app/(dashboard)/admin/desafios/[id]/WinnerActions.tsx",
      "src/app/(dashboard)/admin/desafios/[id]/ChallengeActions.tsx",
      "src/app/(dashboard)/admin/usuarios/UserAdminComponents.tsx",
      "src/app/(dashboard)/admin/premios/RewardAdminComponents.tsx",
      "src/app/(dashboard)/admin/eventos/novo/page.tsx",
      "src/app/(dashboard)/admin/eventos/EventAdminActions.tsx"
    ]
  },
  "qa_signoff": {
    "status": "pending",
    "tests_passed": "",
    "issues": ""
  },
  "final_acceptance": [],
  "last_updated": "2026-01-07T14:36:17.447783+00:00"
}