# Build Progress - Guia de Troubleshooting para Erros Comuns

## Status: Planning Complete
**Data:** 2026-01-07

---

## Análise do Codebase Realizada

### Variáveis de Ambiente Identificadas:
- `NEXT_PUBLIC_SUPABASE_URL` - URL do projeto Supabase (obrigatória)
- `NEXT_PUBLIC_SUPABASE_ANON_KEY` - Chave anon do Supabase (obrigatória)
- `SUPABASE_SERVICE_ROLE_KEY` - Chave de serviço para operações admin (obrigatória para admin)
- `GEMINI_API_KEY` - Chave da API Gemini para verificação de vídeos (opcional)
- `NEXT_PUBLIC_SITE_URL` - URL do site para redirects de auth (obrigatória)
- `EMAIL_SERVER_*` - Variáveis de email (futuro)
- `INSTAGRAM_API_KEY`, `TIKTOK_API_KEY` - APIs sociais (futuro)

### Padrões de Erro Mapeados:

**Autenticação:**
- "Usuario nao autenticado" - Sessão inexistente ou expirada
- "Erro ao fazer login com Google" - OAuth mal configurado
- "Email ou senha incorretos" - Credenciais inválidas
- "Por favor, confirme seu email" - Email não verificado
- "useAuth deve ser usado dentro de um AuthProvider" - Contexto não disponível

**Permissões:**
- "Acesso nao autorizado" - Usuário sem permissão admin
- "Apenas admins podem aprovar/rejeitar" - Verificação de role falhou
- "Nao autorizado" - Falta de credenciais admin

**Configuração:**
- "Missing Supabase admin credentials" - SUPABASE_SERVICE_ROLE_KEY ausente
- "API Gemini nao configurada" - GEMINI_API_KEY ausente ou placeholder
- "Erro ao conectar com API Gemini" - Falha de rede ou chave inválida

**Dados:**
- "Evento/Desafio/Recompensa nao encontrado" - ID inválido ou deletado
- "Voce ja participou/esta inscrito" - Duplicate entry
- "Estoque esgotado" - Stock zerado
- "Saldo insuficiente" - Coins insuficientes

**Servidor:**
- "Erro interno do servidor" - Catch-all para erros não tratados
- "Erro ao..." - Falha em operação específica

---

## Plano de Implementação

### Fase 1: Documentação Principal (TROUBLESHOOTING.md) ✅ COMPLETA
- [x] Estrutura planejada
- [x] 1.1 - Criar estrutura base
- [x] 1.2 - Erros de variáveis de ambiente (7 subseções)
- [x] 1.3 - Erros de autenticação (5 subseções)
- [x] 1.4 - Erros do Supabase (8 subseções)
- [x] 1.5 - Erros de APIs externas (6 subseções: 4.1-4.6)

### Fase 2: Guias de Configuração
- [ ] 2.1 - Guia SETUP_SUPABASE.md
- [ ] 2.2 - Atualizar .env.local.example

### Fase 3: Mensagens de Erro Melhoradas
- [ ] 3.1 - Constantes de erro (src/lib/errors.ts)
- [ ] 3.2 - Componente ErrorDisplay

### Fase 4: Scripts de Diagnóstico
- [ ] 4.1 - Script check-env.ts
- [ ] 4.2 - Comando npm check-env

---

## Notas
- Código usa mix de português (mensagens UI) e inglês (variáveis)
- Supabase RLS é crítico - erros de permissão podem ser confusos
- Gemini API é opcional mas comum gerar confusão quando não configurada

---

## Histórico de Implementação

### 2026-01-07 - Subtask 1.5: Erros de APIs Externas ✅
**Commit:** dbca774

Expandida seção 4 (Erros de APIs Externas) do guia TROUBLESHOOTING.md:

**Subseções adicionadas:**
1. **4.1 - API Gemini não configurada** (já existia, mantida)
   - Instruções para obter API Key do Google AI Studio
   - Configuração da variável GEMINI_API_KEY

2. **4.2 - Erro ao conectar com API Gemini** (já existia, mantida)
   - Validação de API Key
   - Troubleshooting de rate limits
   - Verificação de restrições no Google Cloud

3. **4.3 - URL de Vídeo Inválida** (já existia, mantida)
   - Plataformas suportadas: Instagram, YouTube, TikTok, Facebook
   - Exemplos de URLs válidas
   - Padrões de validação

4. **4.4 - Rate Limit/Quota Excedida do Gemini** (NOVA ✨)
   - Limites do tier gratuito (60 RPM, 1.500 RPD)
   - Instruções para verificar uso atual
   - Estratégias de cache e otimização
   - Opções de upgrade para tier pago

5. **4.5 - Resposta Inesperada da API Gemini** (NOVA ✨)
   - Causas comuns: breaking changes, timeouts, limites de tokens
   - Debugging de respostas malformadas
   - Exemplo de handling robusto com TypeScript
   - Validação de estrutura de resposta

6. **4.6 - Preparando para Futuras Integrações de APIs** (NOVA ✨)
   - Princípios de integração: fallback, retry, logging
   - Exemplos de código TypeScript para patterns recomendados
   - Checklist completo para nova integração (10 itens)
   - Tabela de APIs planejadas (SendGrid, Stripe, Twilio, etc.)
   - Referências de implementação

**Melhorias gerais:**
- Removido aviso "Esta seção será expandida" (agora está completa)
- Adicionado overview da seção com lista de APIs integradas/planejadas
- Documentado comportamento de fallback para operação manual
- Total de 254 linhas adicionadas ao documento

**Resultado:** Fase 1 (Documentação Principal) agora está 100% completa (5/5 subtasks).
Próxima fase: Guias de Configuração Inicial (Fase 2)
