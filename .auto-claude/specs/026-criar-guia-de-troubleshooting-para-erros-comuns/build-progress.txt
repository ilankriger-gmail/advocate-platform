# Build Progress - Guia de Troubleshooting para Erros Comuns

## Status: Planning Complete
**Data:** 2026-01-07

---

## Análise do Codebase Realizada

### Variáveis de Ambiente Identificadas:
- `NEXT_PUBLIC_SUPABASE_URL` - URL do projeto Supabase (obrigatória)
- `NEXT_PUBLIC_SUPABASE_ANON_KEY` - Chave anon do Supabase (obrigatória)
- `SUPABASE_SERVICE_ROLE_KEY` - Chave de serviço para operações admin (obrigatória para admin)
- `GEMINI_API_KEY` - Chave da API Gemini para verificação de vídeos (opcional)
- `NEXT_PUBLIC_SITE_URL` - URL do site para redirects de auth (obrigatória)
- `EMAIL_SERVER_*` - Variáveis de email (futuro)
- `INSTAGRAM_API_KEY`, `TIKTOK_API_KEY` - APIs sociais (futuro)

### Padrões de Erro Mapeados:

**Autenticação:**
- "Usuario nao autenticado" - Sessão inexistente ou expirada
- "Erro ao fazer login com Google" - OAuth mal configurado
- "Email ou senha incorretos" - Credenciais inválidas
- "Por favor, confirme seu email" - Email não verificado
- "useAuth deve ser usado dentro de um AuthProvider" - Contexto não disponível

**Permissões:**
- "Acesso nao autorizado" - Usuário sem permissão admin
- "Apenas admins podem aprovar/rejeitar" - Verificação de role falhou
- "Nao autorizado" - Falta de credenciais admin

**Configuração:**
- "Missing Supabase admin credentials" - SUPABASE_SERVICE_ROLE_KEY ausente
- "API Gemini nao configurada" - GEMINI_API_KEY ausente ou placeholder
- "Erro ao conectar com API Gemini" - Falha de rede ou chave inválida

**Dados:**
- "Evento/Desafio/Recompensa nao encontrado" - ID inválido ou deletado
- "Voce ja participou/esta inscrito" - Duplicate entry
- "Estoque esgotado" - Stock zerado
- "Saldo insuficiente" - Coins insuficientes

**Servidor:**
- "Erro interno do servidor" - Catch-all para erros não tratados
- "Erro ao..." - Falha em operação específica

---

## Plano de Implementação

### Fase 1: Documentação Principal (TROUBLESHOOTING.md)
- [x] Estrutura planejada
- [ ] 1.1 - Criar estrutura base
- [ ] 1.2 - Erros de variáveis de ambiente
- [ ] 1.3 - Erros de autenticação
- [ ] 1.4 - Erros do Supabase
- [ ] 1.5 - Erros de APIs externas

### Fase 2: Guias de Configuração
- [ ] 2.1 - Guia SETUP_SUPABASE.md
- [ ] 2.2 - Atualizar .env.local.example

### Fase 3: Mensagens de Erro Melhoradas
- [ ] 3.1 - Constantes de erro (src/lib/errors.ts)
- [ ] 3.2 - Componente ErrorDisplay

### Fase 4: Scripts de Diagnóstico
- [ ] 4.1 - Script check-env.ts
- [ ] 4.2 - Comando npm check-env

---

## Notas
- Código usa mix de português (mensagens UI) e inglês (variáveis)
- Supabase RLS é crítico - erros de permissão podem ser confusos
- Gemini API é opcional mas comum gerar confusão quando não configurada
