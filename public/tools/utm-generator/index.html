<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UTM Generator - Arena Te Amo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #ff6b6b 0%, #ff8e53 50%, #ffcc80 100%);
        }
        .glass {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }
    </style>
</head>
<body class="gradient-bg min-h-screen py-8 px-4">
    <div class="max-w-2xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-white mb-2">ğŸ”— UTM Generator</h1>
            <p class="text-white/80">Crie links com tracking para suas campanhas</p>
        </div>

        <!-- Form -->
        <div class="glass rounded-2xl p-6 shadow-2xl mb-6">
            <div class="space-y-4">
                <!-- URL Base -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">URL Base *</label>
                    <input type="url" id="url" 
                           class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-orange-400 focus:border-transparent"
                           placeholder="https://comunidade.omocodoteamo.com.br/convite/amor"
                           value="https://comunidade.omocodoteamo.com.br">
                </div>

                <!-- Presets -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Presets RÃ¡pidos</label>
                    <div class="flex flex-wrap gap-2">
                        <button onclick="applyPreset('instagram_bio')" class="px-3 py-1.5 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-full text-sm hover:opacity-90">
                            ğŸ“¸ Instagram Bio
                        </button>
                        <button onclick="applyPreset('instagram_stories')" class="px-3 py-1.5 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-full text-sm hover:opacity-90">
                            ğŸ“± Stories
                        </button>
                        <button onclick="applyPreset('facebook_feed')" class="px-3 py-1.5 bg-blue-600 text-white rounded-full text-sm hover:opacity-90">
                            ğŸ‘ Facebook Feed
                        </button>
                        <button onclick="applyPreset('tiktok')" class="px-3 py-1.5 bg-black text-white rounded-full text-sm hover:opacity-90">
                            ğŸµ TikTok
                        </button>
                        <button onclick="applyPreset('youtube')" class="px-3 py-1.5 bg-red-600 text-white rounded-full text-sm hover:opacity-90">
                            â–¶ï¸ YouTube
                        </button>
                        <button onclick="applyPreset('whatsapp')" class="px-3 py-1.5 bg-green-500 text-white rounded-full text-sm hover:opacity-90">
                            ğŸ’¬ WhatsApp
                        </button>
                    </div>
                </div>

                <!-- UTM Source -->
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">utm_source *</label>
                        <input type="text" id="source" 
                               class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-orange-400"
                               placeholder="instagram, facebook, tiktok...">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">utm_medium</label>
                        <input type="text" id="medium" 
                               class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-orange-400"
                               placeholder="bio, stories, feed...">
                    </div>
                </div>

                <!-- UTM Campaign & Content -->
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">utm_campaign</label>
                        <input type="text" id="campaign" 
                               class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-orange-400"
                               placeholder="lancamento, convite...">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">utm_content</label>
                        <input type="text" id="content" 
                               class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-orange-400"
                               placeholder="cta_principal...">
                    </div>
                </div>

                <!-- Generate Button -->
                <button onclick="generateLink()" 
                        class="w-full py-4 bg-gradient-to-r from-orange-500 to-red-500 text-white font-bold rounded-xl hover:opacity-90 transition-all text-lg shadow-lg">
                    âœ¨ Gerar Link
                </button>
            </div>
        </div>

        <!-- Result -->
        <div id="result" class="hidden glass rounded-2xl p-6 shadow-2xl">
            <h2 class="text-xl font-bold text-gray-800 mb-4">ğŸ¯ Seu Link</h2>
            
            <!-- Link Display -->
            <div class="bg-gray-100 rounded-lg p-4 mb-4 break-all">
                <code id="generatedLink" class="text-sm text-gray-700"></code>
            </div>

            <!-- Action Buttons -->
            <div class="flex gap-3 mb-6">
                <button onclick="copyLink()" 
                        class="flex-1 py-3 bg-gray-800 text-white rounded-lg hover:bg-gray-700 transition-all flex items-center justify-center gap-2">
                    ğŸ“‹ Copiar Link
                </button>
                <button onclick="copyShort()" 
                        class="flex-1 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-500 transition-all flex items-center justify-center gap-2">
                    âœ‚ï¸ Copiar Curto
                </button>
            </div>

            <!-- QR Code -->
            <div class="text-center">
                <h3 class="text-lg font-semibold text-gray-700 mb-3">ğŸ“± QR Code</h3>
                <div id="qrcode" class="inline-block bg-white p-4 rounded-xl shadow-md"></div>
                <div class="mt-3">
                    <button onclick="downloadQR()" 
                            class="px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-400 transition-all">
                        â¬‡ï¸ Baixar QR Code
                    </button>
                </div>
            </div>

            <!-- History -->
            <div class="mt-6 pt-6 border-t border-gray-200">
                <h3 class="text-lg font-semibold text-gray-700 mb-3">ğŸ“œ HistÃ³rico</h3>
                <div id="history" class="space-y-2 max-h-48 overflow-y-auto"></div>
            </div>
        </div>

        <!-- Footer -->
        <div class="text-center mt-8 text-white/70 text-sm">
            Feito com â¤ï¸ por Theo para o Ilan
        </div>
    </div>

    <script>
        const presets = {
            instagram_bio: { source: 'instagram', medium: 'bio', campaign: 'arena_teamo' },
            instagram_stories: { source: 'instagram', medium: 'stories', campaign: 'arena_teamo' },
            facebook_feed: { source: 'facebook', medium: 'feed', campaign: 'arena_teamo' },
            tiktok: { source: 'tiktok', medium: 'bio', campaign: 'arena_teamo' },
            youtube: { source: 'youtube', medium: 'description', campaign: 'arena_teamo' },
            whatsapp: { source: 'whatsapp', medium: 'share', campaign: 'arena_teamo' },
        };

        let history = JSON.parse(localStorage.getItem('utm_history') || '[]');
        let currentLink = '';

        function applyPreset(preset) {
            const p = presets[preset];
            document.getElementById('source').value = p.source;
            document.getElementById('medium').value = p.medium;
            document.getElementById('campaign').value = p.campaign;
        }

        function generateLink() {
            const url = document.getElementById('url').value.trim();
            const source = document.getElementById('source').value.trim();
            const medium = document.getElementById('medium').value.trim();
            const campaign = document.getElementById('campaign').value.trim();
            const content = document.getElementById('content').value.trim();

            if (!url || !source) {
                alert('URL e utm_source sÃ£o obrigatÃ³rios!');
                return;
            }

            const params = new URLSearchParams();
            params.append('utm_source', source);
            if (medium) params.append('utm_medium', medium);
            if (campaign) params.append('utm_campaign', campaign);
            if (content) params.append('utm_content', content);

            const separator = url.includes('?') ? '&' : '?';
            currentLink = url + separator + params.toString();

            // Display link
            document.getElementById('generatedLink').textContent = currentLink;
            document.getElementById('result').classList.remove('hidden');

            // Generate QR Code
            const qrContainer = document.getElementById('qrcode');
            qrContainer.innerHTML = '';
            QRCode.toCanvas(currentLink, { width: 200, margin: 2 }, (err, canvas) => {
                if (!err) qrContainer.appendChild(canvas);
            });

            // Save to history
            const historyItem = {
                link: currentLink,
                source: source,
                date: new Date().toLocaleString('pt-BR')
            };
            history.unshift(historyItem);
            history = history.slice(0, 10); // Keep last 10
            localStorage.setItem('utm_history', JSON.stringify(history));
            renderHistory();

            // Scroll to result
            document.getElementById('result').scrollIntoView({ behavior: 'smooth' });
        }

        function copyLink() {
            navigator.clipboard.writeText(currentLink);
            showToast('Link copiado! ğŸ“‹');
        }

        async function copyShort() {
            // Use TinyURL API for shortening
            try {
                const response = await fetch(`https://tinyurl.com/api-create.php?url=${encodeURIComponent(currentLink)}`);
                const shortUrl = await response.text();
                navigator.clipboard.writeText(shortUrl);
                showToast('Link curto copiado! âœ‚ï¸');
            } catch (e) {
                // Fallback to is.gd
                try {
                    const response = await fetch(`https://is.gd/create.php?format=simple&url=${encodeURIComponent(currentLink)}`);
                    const shortUrl = await response.text();
                    navigator.clipboard.writeText(shortUrl);
                    showToast('Link curto copiado! âœ‚ï¸');
                } catch (e2) {
                    navigator.clipboard.writeText(currentLink);
                    showToast('Erro ao encurtar, link completo copiado');
                }
            }
        }

        function downloadQR() {
            const canvas = document.querySelector('#qrcode canvas');
            if (canvas) {
                const link = document.createElement('a');
                link.download = 'qrcode-arena-teamo.png';
                link.href = canvas.toDataURL();
                link.click();
                showToast('QR Code baixado! ğŸ“±');
            }
        }

        function renderHistory() {
            const container = document.getElementById('history');
            container.innerHTML = history.map((item, i) => `
                <div class="flex items-center justify-between bg-gray-50 rounded-lg p-2 text-sm">
                    <div class="truncate flex-1 mr-2">
                        <span class="text-orange-500 font-medium">${item.source}</span> - 
                        <span class="text-gray-500">${item.date}</span>
                    </div>
                    <button onclick="copyFromHistory(${i})" class="px-2 py-1 bg-gray-200 rounded hover:bg-gray-300">ğŸ“‹</button>
                </div>
            `).join('');
        }

        function copyFromHistory(index) {
            navigator.clipboard.writeText(history[index].link);
            showToast('Copiado do histÃ³rico!');
        }

        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'fixed bottom-4 left-1/2 -translate-x-1/2 bg-gray-900 text-white px-6 py-3 rounded-full shadow-lg z-50';
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 2000);
        }

        // Initial render
        renderHistory();
    </script>
</body>
</html>
